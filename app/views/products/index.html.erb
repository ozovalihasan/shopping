<%= render component("frame/body") do %>
  <div class="flex" data-controller="left-search-form">
    <%= form_with(
      url: products_path,
      method: :get,
      class: "w-1/5",
      data: {
        turbo_frame: search_results_target,
        turbo_action: "advance",
        action: "turbo:before-fetch-response->left-search-form#removeOpacity turbo:frame-load->left-search-form#_setLeftSearchForm",
        left_search_form_target: "form",
      }
    ) do |form| %>
      <%= form.hidden_field :search_term, 
                            value: @search_term, 
                            data: {
                              left_search_form_target: "searchTerm"
                            } 
      %>

      <%= form.hidden_field :price_order, 
                            value: @price_order, 
                            data: {
                              left_search_form_target: "priceOrder"
                            } 
      %>
      
      <details class="w-full p-4 ">
        <summary class="font-black py-2">Category</summary>
        <div class="">
          <%= render component("search/categories_tree", main_categories: @main_categories, category_id: @category_id, form: form) %>
          
        </div>
      </details> 

      <details class="w-full p-4 ">
        <summary class="font-black py-2">Brand</summary>
        
        <div class="h-96 overflow-y-scroll  border-l-4 w-full p-4">
          <%= form.collection_check_boxes :brand_ids,  
                                          @brands, 
                                          :id, 
                                          :name, 
                                          { include_hidden: false, checked: @brand_ids}, 
                                          data: {
                                            action: "input->left-search-form#search", 
                                            left_search_form_target: "brand"
                                          } do |b| 
          %>
            <div class="flex">
              <%= b.check_box %>
              <%= b.label class: "ml-2 whitespace-nowrap overflow-hidden text-ellipsis" %>
            </div>
          <% end %>
        </div>
      </details> 
      
      
    <% end %>
    
    <%= turbo_frame_tag search_results_target, class: "w-4/5" do %>
      <div>
        <%= @products_count %> products found <% unless @search_term == "" %>
                                                for <span class="font-bold"> <%= @search_term %> </span>
                                              <% end %> 

        <%= select_tag :price_order, options_for_select([
                            ["Price: Low to High", :lowest_price], 
                            ["Price: High to Low", :highest_price],
                            ["Avg. Customer Review", :highest_review_rate],
                            ["Discount: High to Low", :highest_discount],
                            
                          ], @price_order), {include_blank: "Sort", 
                          data: { 
                            action: "input->left-search-form#setPriceOrder" 
                          }} 
        %>
      </div>
      
      
      <%= 
        render component(
          "products/infinite_scroll_start_page",
          products: @products, 
          last_page: @last_page, 
          search_term: @search_term,
          category_id: @category_id,
          price_order: @price_order
        ) 
      %>
    <% end %>
  </div>
<% end %>